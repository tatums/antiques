<div id="show-product">
  <span class="block photo">
    <ul id="images">
      <li class="featured">
        <%= link_to image_tag(@product.image_url(:thumb_300) ), @product.image_url(:large),
          :class => 'single_image' if @product.image? %>
      </li>
    </ul>

      <ul class="additonal-images">
      <%= render @product.images %>
      </ul>
  </span>
  <span class="block show-meta">
    <%= span_tag_if_sold?(@product) %>

	  <ul>
    <li><h3><%= @product.title %></h3></li>
    <li><%= country_and_period(@product) %></li>
    <li>Inventory Number: <%= @product.item_number %></li>
      <%= setup_paragraphs(@product).html_safe %>
      <%= formatted_dimensions(@product.dimensions) %>
      <%= formatted_price(@product.price) %>
      <li><%= link_to "Print a Tear Sheet", product_path(@product, :format => 'pdf', :class => 'print_link') %></li>

    </ul>

    <% if current_user %>
      <p>
      <%= link_to 'Edit', edit_product_path(@product), :class => "nice small white radius button no-print" %>


      <%= form_for([@product, Image.new],:remote => true, :html => {:id => 'image-upload',:multipart => true }) do |f| %>
        <div class="upload-field">
          <input id="fileupload" type="file" name="image[image]" multiple class="nice small white radius button no-print">
        </div>
      <% end %>


      <%= link_to 'Invoice', invoice_product_setup_path(Invoice, @product), :class => "nice small white radius button no-print" %>
      </p><br />
      <p>
        <%= link_to 'Delete', @product, confirm: "Are you sure?", method: :delete, :class => "nice small red radius button" %>
      </p>




      <div id="keywords-widget" class="no-print">
        <h4>Keywords</h4>
        <ul id="keywords">
          <%= render @product.keywords, :locals => { :list => true } %>
        </ul>

        <div id="keyword-form">
          <%= form_for([@product, Keyword.new], :remote => true, :html => {:class=> "nice"}) do |f| %>
            <div class="field edit-product">
              <%= f.text_field :title, :class => "small input-text", :placeholder => "keyword" %>
            </div>
            <div class="actions">
              <%= f.submit 'Save Keyword', :id => "keyword-submit", :class => "nice small radius button" %>
            </div>
          <% end %>
        </div>
      </div>
      <p class="timestamps no-print">
        Created on <%= @product.created_at.strftime("%m/%d/%Y at %I:%M %p") %><br />
        Updated on <%= @product.updated_at.strftime("%m/%d/%Y at %I:%M %p") %>
      </p>
    <% end %>
  </span>

</div>




<script src="/js/file-upload/jquery.ui.widget.js"></script>
<script src="/js/file-upload/jquery.iframe-transport.js"></script>
<script src="/js/file-upload/jquery.fileupload.js"></script>

<script>
$(function () {
    $('#fileupload').fileupload({
        dataType: 'json',
        url: '<%= product_images_path(@product.id) %>',
        done: function (e, data) {
            $.each(data.result, function (index, response) {


              console.log(response)
                //$('#thumbs').html(object.name).appendTo(document.body);
                //console.log("<%= escape_javascript( @image ) %>")
                //$('#additional-images').html("<%= escape_javascript(render @product.images ) %>")
                //console.log(file);

                // <li id="image_134">
                //   <a href="/uploads/image/image/134/large_01848_flow_1680x1050.jpg" class="single_image">
                //     <img alt="Thumb_200_01848_flow_1680x1050" src="/uploads/image/image/134/thumb_200_01848_flow_1680x1050.jpg">
                //   </a>
                //   <a href="/images/134" class="delete-image white small button no-print" data-confirm="Are you sure?" data-method="delete" data-remote="true" rel="nofollow">X
                //   </a>
                // </li>


               $('<li><img src="'+response+'"></li>').appendTo('.additonal-images');


            });
            $('#spinner').hide();
            //window.location.reload(true);

        }
    });
});
</script>

